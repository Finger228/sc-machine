<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Agents - SC-machine</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Agents";
    var mkdocs_page_input_path = "cpp/kpm.md";
    var mkdocs_page_url = "/cpp/kpm/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> SC-machine</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Build</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../build/linux-build/">Build on Linux</a>
                </li>
                <li class="">
                    
    <a class="" href="../../build/windows-build/">Build on Windows</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Development</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../dev/git-workflow/">Git-workflow</a>
                </li>
                <li class="">
                    
    <a class="" href="../../dev/pr/">Pull requets</a>
                </li>
                <li class="">
                    
    <a class="" href="../../dev/codestyle/">Codestyle</a>
                </li>
                <li class="">
                    
    <a class="" href="../../dev/test/">Unit tests</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">API</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../cpp-meta/">Meta programming</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Agents</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#scmodule">ScModule</a></li>
    

    <li class="toctree-l3"><a href="#scagent">ScAgent</a></li>
    

    <li class="toctree-l3"><a href="#scevent">ScEvent</a></li>
    

    <li class="toctree-l3"><a href="#scwait">ScWait</a></li>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../templates/">Template</a>
                </li>
                <li class="">
                    
    <a class="" href="../common/">Common</a>
                </li>
                <li class="">
                    
    <a class="" href="../../python/python/">Python</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Common</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../el_types/">Element types</a>
                </li>
                <li class="">
                    
    <a class="" href="../../other/config/">Configuration files</a>
                </li>
                <li class="">
                    
    <a class="" href="../../net/sctp/">Sctp-protocol</a>
                </li>
                <li class="">
                    
    <a class="" href="../../other/scs/">SCs language</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../license/">License</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../changelog/">Changelog</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../thirdparty/">Thirdparty</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">SC-machine</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>API &raquo;</li>
        
      
    
    <li>Agents</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <p>Knowledge processing machine (KPM) - is a set of modules. Each module contains implementation of sc-agents. Also they can contains any other functions and classes, than used by sc-agents implementation.</p>
<h2 id="scmodule">ScModule</h2>
<p>Module - is a dynamic library. That implement specified module class.
To create module you need to do next steps:</p>
<ol>
<li>Create directory for you module in sc-kpm. For example: <code>sc-kpm/nl</code>;</li>
<li>Go to created directory;</li>
<li>Create file <code>CMakeLists.txt</code> with content (replace nl (module name) to yours one:</li>
</ol>
<p><strong>CMakeLists.txt</strong></p>
<pre><code class="bash"> set(SC_IOT_SRC &quot;${SC_KPM_ROOT}/nl&quot;)

set(SOURCES
    &quot;nl.cpp&quot;
)
set(HEADERS
    &quot;nl.hpp&quot;
)

include_directories(${SC_IOT_SRC} ${SC_MEMORY_SRC} ${GLIB2_INCLUDE_DIRS})

add_library (nl SHARED ${SOURCES} ${HEADERS})
add_dependencies(nl sc-memory-cpp sc-kpm-common)
target_link_libraries(nl sc-memory-cpp sc-kpm-common)

sc_codegen(nl ${SC_IOT_SRC})
</code></pre>

<p>After that you need to create two files (cpp, hpp):</p>
<p><strong>nl.hpp</strong></p>
<pre><code class="cpp">#pragma once

#include &quot;sc_memory.h&quot;
#include &quot;cpp/sc_module.hpp&quot;

#include &quot;nl.generated.hpp&quot;

class nlModule : public ScModule
{
  SC_CLASS(LoadOrder(11))
  SC_GENERATED_BODY()

  virtual sc_result InitializeImpl() override;
  virtual sc_result ShutdownImpl() override;
};
</code></pre>

<p><strong>nl.cpp</strong></p>
<pre><code class="cpp">#include &quot;nl.hpp&quot;

SC_IMPLEMENT_MODULE(nlModule)

sc_result nlModule::InitializeImpl()
{
  return SC_RESULT_OK;
}

sc_result nlModule::ShutdownImpl()
{
  return SC_RESULT_OK;
}
</code></pre>

<h2 id="scagent">ScAgent</h2>
<p>To create sc-agent implementation you need:
1. create source and header file for sc-agent implementation
2. add created files into <code>CMakeLists.txt</code></p>
<p><strong>CMakeLists.txt</strong></p>
<pre><code class="bash">...

set(SOURCES
  &quot;nl.cpp&quot;
  &quot;nlApiAi.cpp&quot;
)
set(HEADERS
  &quot;nl.hpp&quot;
  &quot;nlApiAi.hpp&quot;
)

...
</code></pre>

<p><strong>nlApiAi.hpp</strong></p>
<pre><code class="cpp">#pragma once

#include &quot;wrap/kpm/sc_agent.hpp&quot;
#include &quot;nlApiAi.generated.hpp&quot;

namespace nl
{
  class AApiAiParseUserTextAgent : public ScAgentAction
  {
    SC_CLASS(Agent, CmdClass(&quot;command_process_user_text_message&quot;))
    SC_GENERATED_BODY()
  };
}
</code></pre>

<p><strong>nlApiAi.cpp</strong></p>
<pre><code class="cpp">#include &quot;nlApiAi.hpp&quot;

namespace nl
{
  SC_AGENT_ACTION_IMPLEMENTATION(AApiAiParseUserTextAgent)
  {
    // implement agent logic there
    return SC_RESULT_ERROR;
  }
}
</code></pre>

<p><strong>SC_AGENT_ACTION_IMPLEMENTATION</strong> - is a macros that insert generated code an minimize work. You just insert this one (with class name as parameter), and implement it like a function. During implementation you can use such variables:
<em> <code>requestAddr</code> - <code>ScAddr</code> of command (action) instance that was initiated;
</em> <code>resultAddr</code> - <code>ScAddr</code> of sc-structure that designate command (action) result;
* <code>mMemoryCtx</code> - memory context that can be used to work with <code>ScMemory</code>.</p>
<p>If sc-agent finished work without any errors, then it must return <code>SC_RESULT_OK</code>, otherwise - one of code error <code>SC_RESULT_ERROR_...</code>.
Result of agent will be automaticaly added into specified set:</p>
<p><img alt="Example of succesfully finished command" src="../images/sc_result_ok_example.png" /></p>
<p>Possible result sets:</p>
<ul>
<li><code>sc_result_error</code> - unknown error;</li>
<li><code>sc_result_ok</code> - no any errors (successfull finish);</li>
<li><code>sc_result_error_invalid_params</code> - invalid parameters of agent;</li>
<li><code>sc_result_error_invalid_type</code> - invalid type error (invalid type of data of something else);</li>
<li><code>sc_result_error_io</code> - input/output error (can't read/write something from/to any source);</li>
<li><code>sc_result_invalid_state</code> - invalid state of processing data;</li>
<li><code>sc_result_error_not_found</code> - something wasn't found (for example: can't resolve element by identifier);</li>
<li><code>sc_result_error_no_write_rights</code> - agent hasn't rights to write something;</li>
<li><code>sc_result_error_no_read_rights</code> - agent hans't rights to read something.</li>
</ul>
<p><strong>It's important:</strong></p>
<ul>
<li>All sc-agents class names must to be started with A symbol;</li>
<li>You can implement more than one <code>ScAgent</code> class in on source/header file;</li>
<li>Don't use any other memory contexts instead of <code>mMemoryCtx</code> in <code>ScAgent</code> implementation;</li>
<li>You need always include <code>&lt;you_header&gt;.generated.hpp</code> file into your header, if you have any metadata. This include must be a last one in a file.</li>
</ul>
<h2 id="scevent">ScEvent</h2>
<p>This type of objects allows you to subscribe to any events in <code>ScMemory</code>. There are c++ classes that correspond to specified event types:</p>
<ul>
<li><code>ScEventAddOutputEdge</code> - emits each time, when output (outgoing) edge (from specified element) added;</li>
<li><code>ScEventAddInputEdge</code> - emits each time, when input (ingoing) edge (into specified element) added;</li>
<li><code>ScEventRemoveOutputEdge</code> - emits each time, when output (outgoing) edge (from specified element) removed;</li>
<li><code>ScEventRemoveInputEdge</code> - emits each time, when input (ingoing) edge (into specified element) removed;</li>
<li><code>ScEventEraseElement</code> - emits, when specified element removed;</li>
<li><code>ScEventContentChanged</code> - emits each time, when content of specified sc-link changed.</li>
</ul>
<p>Each event constructor takes 3 parameters:</p>
<ul>
<li><code>ctx</code> - <code>ScMemoryContext</code> that will be used to work with event;</li>
<li><code>addr</code> - <code>ScAddr</code> of element that need to be listen for a specified event;</li>
<li><code>func</code> - delegate to a callback function, that will be called on each event emit (<code>bool func(ScAddr const &amp; listenAddr, ScAddr const &amp; edgeAddr, ScAddr const &amp; otherAddr)</code>). Description of parameters for this function you can see in table below (for each event type). <strong>Note: callback function will be called in another thread!</strong></li>
</ul>
<p>Table of description (parameters of callback function named on pictures, if there are no parameter name on picture, then it's would have an empty value):
<table width="95%">
  <tr>
    <th>Class</th>
    <th>Description</th>
  </tr></p>
<p><tr>
    <td><strong>ScEventAddOutputEdge</strong></td>
    <td>
      <img src="../../images/sc-events/sc-event-output-edge.png"></img>
      <br/>
      Callback calls each time, when any type edge <code>edgeAddr</code> between <code>listenAddr</code> and <code>otherAddr</code> create.
      <hr/>
      <strong>Example C++ code</strong>:
      <pre><code class="cpp hljs">
auto const callback <a href="../ScAddr const &amp; listenAddr,
                       ScAddr const &amp; edgeAddr,
                       ScAddr const &amp; otherAddr"></a>
{
    // listenAddr - ScAddr of source element
    //  (listen it in event)
    // edgeAddr - ScAddr of added output edge
    // otherAddr - target element of added edge
    ...
    return true; // if failed, then return false
};
ScEventAddOutputEdge evt(ctx, addr, callback);
      </code><pre>
    </td>
  </tr></p>
<p><tr>
    <td><strong>ScEventAddInputEdge</strong></td>
    <td>
      <img src="../../images/sc-events/sc-event-input-edge.png"></img>
      <br/>
      Callback calls each time, when any type edge <code>edgeAddr</code> between <code>otherAddr</code> and <code>listenAddr</code> create.
      <hr/>
      <strong>Example C++ code</strong>:
      <pre><code class="cpp hljs">
auto const callback <a href="../ScAddr const &amp; listenAddr,
                       ScAddr const &amp; edgeAddr,
                       ScAddr const &amp; otherAddr"></a>
{
    // listenAddr - ScAddr of target element
    //  (listen it in event)
    // edgeAddr - ScAddr of added input edge
    // otherAddr - source element of added edge
    ...
    return true; // if failed, then return false
};
ScEventAddInputEdge evt(ctx, addr, callback);
      </code></pre>
    </td>
  </tr></p>
<p><tr>
    <td><strong>ScEventRemoveOutputEdge</strong></td>
    <td>
      <img src="../../images/sc-events/sc-event-output-edge.png"></img>
      <br/>
      Callback calls each time, when any type edge <code>edgeAddr</code> between <code>listenAddr</code> and any element <code>otherAddr</code> erase.
      <hr/>
      <strong>Example C++ code</strong>:
      <pre><code class="cpp hljs">
auto const callback <a href="../ScAddr const &amp; listenAddr,
                       ScAddr const &amp; edgeAddr,
                       ScAddr const &amp; otherAddr"></a>
{
    // listenAddr - ScAddr of source element
    //  (listen it in event)
    // edgeAddr - ScAddr of erased output edge
    // otherAddr - target element of erased edge
    ...
    return true; // if failed, then return false
};
ScEventRemoveOutputEdge evt(ctx, addr, callback);
      </code></pre>
    </td>
  </tr></p>
<p><tr>
    <td><strong>ScEventRemoveInputEdge</strong></td>
    <td>
      <img src="../../images/sc-events/sc-event-input-edge.png"></img>
      <br/>
      Callback calls each time, when any type edge <code>edgeAddr</code> between any element <code>otherAddr</code> and <code>listenAddr</code> erase.
      <hr/>
      <strong>Example C++ code</strong>:
      <pre><code class="cpp hljs">
auto const callback <a href="../ScAddr const &amp; listenAddr,
                       ScAddr const &amp; edgeAddr,
                       ScAddr const &amp; otherAddr"></a>
{
    // listenAddr - ScAddr of target element
    //  (listen it in event)
    // edgeAddr - ScAddr of erased input edge
    // otherAddr - source element of erased edge
    ...
    return true; // if failed, then return false
};
ScEventRemoveOutputEdge evt(ctx, addr, callback);
      </code></pre>
    </td>
  </tr></p>
<p><tr>
    <td><strong>ScEventEraseElement</strong></td>
    <td>
    Callback calls when <code>listenAddr</code> erased.
    <hr/>
    <strong>Example C++ code</strong>:
    <pre><code class="cpp hljs">
auto const callback <a href="../ScAddr const &amp; listenAddr,
                       ScAddr const &amp; edgeAddr,
                       ScAddr const &amp; otherAddr"></a>
{
  // listenAddr - ScAddr of erased element
  //  (listen it in event)
  // edgeAddr - empty
  // otherAddr - empty
  ...
  return true; // if failed, then return false
};
ScEventEraseElement evt(ctx, addr, callback);
    </code></pre>
    </td>
  </tr></p>
<p><tr>
    <td><strong>ScEventContentChanged</strong></td>
    <td>
      <img src="../../images/sc-events/sc-event-content.png"></img>
      <br/>
      Callback calls when content of <code>listenAddr</code> changed.
      <hr/>
      <strong>Example C++ code</strong>:
      <pre><code class="cpp hljs">
auto const callback <a href="../ScAddr const &amp; listenAddr,
                       ScAddr const &amp; edgeAddr,
                       ScAddr const &amp; otherAddr"></a>
{
  // listenAddr - ScAddr of element that has
  //     content changed (listen it in event)
  // edgeAddr - empty
  // otherAddr - empty
  ...
  return true; // if failed, then return false
};
ScEventContentChanged evt(ctx, addr, callback);
      </code></pre>
    </td>
  </tr>
</table></p>
<h2 id="scwait">ScWait</h2>
<p>This type of objects used to wait until some event emits. It usually used, when on of an <code>ScAgent</code> want to wait result of another one. There are next kind of <code>ScWait</code> objects:</p>
<ul>
<li><code>ScWait</code>- lock run flow until simple event emits. You can see the list of this events in the Class propertires table (Event property);</li>
<li><code>ScWaitCondition</code> - lock run flow until simple event emits and specified conditional check returns true. Another words, this works like an <code>ScWait</code>, but returns to run flow if special condition function returns true. Condition function receive 3 parameters (see <a href="#scevent">ScEvent</a> for more details about them);</li>
<li><code>ScWaitConstruction</code> - wait object, that wait until specified construction would be appeared in a memory. <strong>(Not implemented yet)</strong></li>
</ul>
<p>There are some examples of usage for specified <code>ScWait</code> objects:</p>
<p><strong>Wait input edge into addr</strong></p>
<pre><code class="cpp">ScWait&lt;ScEventAddInputEdge&gt; waiter(ctx, addr);
waiter.Wait();
</code></pre>

<p><strong>Wait input edge into addr, with condition</strong></p>
<pre><code class="cpp">auto check = [](ScAddr const &amp; listenAddr,
                ScAddr const &amp; edgeAddr,
                ScAddr const &amp; otherAddr)
{
  ... // check condition there
  return false; // return true or false depending on condition
};
ScWaitCondition&lt;ScEventAddInputEdge&gt; waiter(ctx, addr, SC_WAIT_CHECK(check));
waiter.Wait();
</code></pre>

<p>There are some preimplemented most common waiters:
* <code>ScWaitActionFinished</code> - wait until specified <code>command</code> will be finished. Example:</p>
<pre><code class="cpp">...
ScWaitActionFinished waiter(ctx, commandAddr);
waiter.Wait();
...
</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../templates/" class="btn btn-neutral float-right" title="Template">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../cpp-meta/" class="btn btn-neutral" title="Meta programming"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>
    
  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../cpp-meta/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../templates/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script src="../../js/theme.js"></script>

</body>
</html>
